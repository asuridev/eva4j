plugins {
    id 'java'
    id 'org.springframework.boot' version '<%= springBootVersion %>'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = '<%= groupId %>'
version = '<%= version %>'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<%= javaVersion %>)
    }
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencyManagement {
    imports {
        mavenBom "org.springframework.modulith:spring-modulith-bom:<%= springModulithVersion %>"
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:<%= springCloudVersion %>"
    }
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    
    // Spring Modulith - Mandatory
    implementation 'org.springframework.modulith:spring-modulith-starter-core'
    implementation 'org.springframework.modulith:spring-modulith-starter-jpa'

    // Spring Cloud OpenFeign
    implementation 'org.springframework.cloud:spring-cloud-starter-openfeign'
<% if (dependencies.includes('web')) { %>    implementation 'org.springframework.boot:spring-boot-starter-web'
<% } %><% if (dependencies.includes('data-jpa')) { %>    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
<% } %><% if (dependencies.includes('security')) { %>    implementation 'org.springframework.boot:spring-boot-starter-security'
<% } %><% if (dependencies.includes('validation')) { %>    implementation 'org.springframework.boot:spring-boot-starter-validation'
<% } %><% if (dependencies.includes('actuator')) { %>    implementation 'org.springframework.boot:spring-boot-starter-actuator'
<% } %><% if (features.includeDevtools) { %>    developmentOnly 'org.springframework.boot:spring-boot-devtools'
<% } %><% if (features.includeLombok) { %>    
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
<% } %><% if (dependencies.includes('data-jpa')) { %>    
    runtimeOnly '<%= databaseDriver %>'
<% } %><% if (features.includeSwagger) { %>    
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
<% } %>    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
<% if (dependencies.includes('security')) { %>    testImplementation 'org.springframework.security:spring-security-test'
<% } %><% if (testing.includeTestcontainers && dependencies.includes('data-jpa')) { %>    testImplementation 'org.testcontainers:testcontainers:1.19.3'
    testImplementation 'org.testcontainers:<%= databaseTestcontainer %>:1.19.3'
<% } %>}

tasks.named('test') {
    useJUnitPlatform()
}
