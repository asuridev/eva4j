package <%= packageName %>.<%= moduleName %>.application.usecases;

import io.temporal.activity.ActivityOptions;
import io.temporal.common.RetryOptions;
import io.temporal.workflow.Saga;
import io.temporal.workflow.SignalMethod;
import io.temporal.workflow.QueryMethod;
import io.temporal.workflow.Workflow;

import java.time.Duration;

public class <%= flowPascalCase %>WorkFlowImpl implements <%= flowPascalCase %>WorkFlow {

    private Saga.Options sagaOptions = new Saga.Options.Builder()
        .setParallelCompensation(false)
        .build();

    private Saga saga = new Saga(sagaOptions);

    private final ActivityOptions lightActivityOptions = ActivityOptions.newBuilder()
        .setStartToCloseTimeout(Duration.ofSeconds(30))
        .setTaskQueue("LIGHT_TASK_QUEUE")
        .setRetryOptions(
            RetryOptions.newBuilder()
                .setMaximumAttempts(2)
                .setInitialInterval(Duration.ofSeconds(1))
                .setMaximumInterval(Duration.ofSeconds(10))
                .setBackoffCoefficient(2.0)
                .build()
        ).build();

    private final ActivityOptions heavyActivityOptions = ActivityOptions.newBuilder()
        .setStartToCloseTimeout(Duration.ofSeconds(120))
        .setTaskQueue("HEAVY_TASK_QUEUE")
        .setRetryOptions(
            RetryOptions.newBuilder()
                .setMaximumAttempts(2)
                .setInitialInterval(Duration.ofSeconds(1))
                .setMaximumInterval(Duration.ofSeconds(10))
                .setBackoffCoefficient(2.0)
                .build()
        ).build();

    @Override
    public void start(String workFlowId) {
        try {
            //todo: workflow logic
        } catch (Exception e) {
            saga.compensate();
        }
    }

    @SignalMethod
    @Override
    public void confirm() {

    }

    @QueryMethod
    @Override
    public String getStatus() {
        return "";
    }
}
