package <%= packageName %>.<%= moduleName %>.application.mappers;

import <%= packageName %>.<%= moduleName %>.application.dtos.<%= aggregateName %>ResponseDto;
<% secondaryEntities.forEach(entity => { %>
import <%= packageName %>.<%= moduleName %>.application.dtos.<%= entity.name %>Dto;
<% }); %>
import <%= packageName %>.<%= moduleName %>.domain.models.entities.<%= aggregateName %>;
<% secondaryEntities.forEach(entity => { %>
import <%= packageName %>.<%= moduleName %>.domain.models.entities.<%= entity.name %>;
<% }); %>
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

/**
 * <%= aggregateName %>ResponseMapper
 * Maps <%= aggregateName %> domain entities to response DTOs
 */
@Component
public class <%= aggregateName %>ResponseMapper {

    /**
     * Map <%= aggregateName %> aggregate to <%= aggregateName %>ResponseDto
     */
    public <%= aggregateName %>ResponseDto toDto(<%= aggregateName %> entity) {
        if (entity == null) {
            return null;
        }
        
        return new <%= aggregateName %>ResponseDto(
<% rootEntity.fields.forEach((field, idx) => { %>
            entity.get<%= field.name.charAt(0).toUpperCase() + field.name.slice(1) %>()<% if (idx < rootEntity.fields.length - 1 || rootEntity.relationships.filter(r => r.type === 'OneToMany' && !r.isInverse).length > 0) { %>,<% } %>
<% }); %>
<% rootEntity.relationships.filter(r => r.type === 'OneToMany' && !r.isInverse).forEach((rel, idx, arr) => { %>
            entity.get<%= rel.fieldName.charAt(0).toUpperCase() + rel.fieldName.slice(1) %>() != null ?
                entity.get<%= rel.fieldName.charAt(0).toUpperCase() + rel.fieldName.slice(1) %>().stream()
                    .map(this::to<%= rel.target %>Dto)
                    .collect(Collectors.toList()) : null<% if (idx < arr.length - 1) { %>,<% } %>
<% }); %>
        );
    }
    
    /**
     * Map List of <%= aggregateName %> to List of <%= aggregateName %>ResponseDto
     */
    public List<<%= aggregateName %>ResponseDto> toDto(List<<%= aggregateName %>> entities) {
        if (entities == null) {
            return new ArrayList<>();
        }
        return entities.stream()
            .map(this::toDto)
            .collect(Collectors.toList());
    }
    
<% secondaryEntities.forEach(entity => { %>
    /**
     * Map <%= entity.name %> to <%= entity.name %>Dto
     */
    private <%= entity.name %>Dto to<%= entity.name %>Dto(<%= entity.name %> entity) {
        if (entity == null) {
            return null;
        }
        
        return new <%= entity.name %>Dto(
<% entity.fields.forEach((field, idx) => { %>
            entity.get<%= field.name.charAt(0).toUpperCase() + field.name.slice(1) %>()<% if (idx < entity.fields.length - 1) { %>,<% } %>
<% }); %>
        );
    }
    
<% }); %>
}
