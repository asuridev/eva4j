<%
// Helper function to generate example ID based on type
function getExampleId() {
  const idExamples = {
    'String': '123',
    'Long': '123',
    'Integer': '123',
    'UUID': '550e8400-e29b-41d4-a716-446655440000'
  };
  return idExamples[idType] || '1';
}

// Generate dummy value based on field type
function generateDummyValue(field, depth = 0) {
  const MAX_DEPTH = 3;
  
  if (depth >= MAX_DEPTH) return null;
  
  // Handle basic types
  const basicTypes = {
    'String': `Example ${field.name}`,
    'Integer': 123,
    'Long': 123456789,
    'Double': 99.99,
    'BigDecimal': '99.99',
    'Boolean': true,
    'LocalDate': '2026-02-03',
    'LocalDateTime': '2026-02-03T10:30:00',
    'LocalTime': '10:30:00',
    'UUID': '550e8400-e29b-41d4-a716-446655440000'
  };
  
  if (basicTypes[field.javaType]) {
    return basicTypes[field.javaType];
  }
  
  // Handle enums
  if (field.isEnum && rootEntity.enums) {
    const enumDef = rootEntity.enums.find(e => e.name === field.javaType);
    if (enumDef && enumDef.values && enumDef.values.length > 0) {
      return enumDef.values[0];
    }
    return 'EXAMPLE_VALUE';
  }
  
  // Handle value objects (nested objects)
  if (field.isValueObject) {
    const voName = field.javaType.toLowerCase();
    if (voName.includes('money') || voName.includes('price') || voName.includes('amount')) {
      return {
        amount: '99.99',
        currency: 'USD'
      };
    }
    if (voName.includes('address')) {
      return {
        street: '123 Main St',
        city: 'New York',
        state: 'NY',
        zipCode: '10001',
        country: 'USA'
      };
    }
    if (voName.includes('email')) {
      return {
        value: 'example@email.com'
      };
    }
    if (voName.includes('phone')) {
      return {
        value: '+1-555-0123'
      };
    }
    // Generic value object
    return {
      value: `example_${field.name}`
    };
  }
  
  // Handle collections
  if (field.isCollection) {
    return [`example_item_1`, `example_item_2`];
  }
  
  return `example_${field.name}`;
}

// Generate nested relationship object
function generateNestedObject(rel, depth = 0) {
  const MAX_DEPTH = 3;
  
  if (depth >= MAX_DEPTH) return null;
  
  const obj = {};
  
  // Add fields from the relationship entity
  if (rel.fields && rel.fields.length > 0) {
    rel.fields.forEach(field => {
      obj[field.name] = generateDummyValue(field, depth + 1);
    });
  }
  
  // Add nested relationships recursively
  if (rel.hasNestedRelationships && rel.nestedRelationships) {
    rel.nestedRelationships.forEach(nestedRel => {
      const nestedObj = generateNestedObject(nestedRel, depth + 1);
      if (nestedObj) {
        obj[nestedRel.fieldName] = [nestedObj];
      }
    });
  }
  
  return obj;
}

// Helper function to generate complete create body
function generateCreateBody() {
  const body = {};
  
  // Add regular fields
  commandFields.forEach(field => {
    body[field.name] = generateDummyValue(field);
  });
  
  // Add nested relationships
  if (oneToManyRelationships && oneToManyRelationships.length > 0) {
    oneToManyRelationships.forEach(rel => {
      const nestedObj = generateNestedObject(rel, 0);
      if (nestedObj) {
        body[rel.fieldName] = [nestedObj];
      }
    });
  }
  
  return body;
}
%>
{
  "info": {
    "_postman_id": "<%= collectionId %>",
    "name": "<%= aggregateName %> API",
    "description": "Auto-generated CRUD API for <%= aggregateName %> aggregate\nModule: <%= moduleName %>\nGenerated by eva4j",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost",
      "type": "string"
    },
    {
      "key": "port",
      "value": "<%= port %>",
      "type": "string"
    },
    {
      "key": "apiVersion",
      "value": "<%= apiVersion %>",
      "type": "string"
    },
    {
      "key": "resource",
      "value": "<%= resourceNameKebab %>",
      "type": "string"
    },
    {
      "key": "exampleId",
      "value": "<%= getExampleId() %>",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Create <%= aggregateName %>",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}:{{port}}/api/{{apiVersion}}/{{resource}}",
          "protocol": "http",
          "host": ["{{baseUrl}}"],
          "port": "{{port}}",
          "path": ["api", "{{apiVersion}}", "{{resource}}"]
        },
        "body": {
          "mode": "raw",
          "raw": <%- JSON.stringify(JSON.stringify(generateCreateBody(), null, 2)) %>,
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "response": []
    },
    {
      "name": "Get <%= aggregateName %> by ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}:{{port}}/api/{{apiVersion}}/{{resource}}/{{exampleId}}",
          "protocol": "http",
          "host": ["{{baseUrl}}"],
          "port": "{{port}}",
          "path": ["api", "{{apiVersion}}", "{{resource}}", "{{exampleId}}"]
        }
      },
      "response": []
    },
    {
      "name": "Get All <%= aggregateName %>s",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}:{{port}}/api/{{apiVersion}}/{{resource}}",
          "protocol": "http",
          "host": ["{{baseUrl}}"],
          "port": "{{port}}",
          "path": ["api", "{{apiVersion}}", "{{resource}}"]
        }
      },
      "response": []
    },
    {
      "name": "Delete <%= aggregateName %>",
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}:{{port}}/api/{{apiVersion}}/{{resource}}/{{exampleId}}",
          "protocol": "http",
          "host": ["{{baseUrl}}"],
          "port": "{{port}}",
          "path": ["api", "{{apiVersion}}", "{{resource}}", "{{exampleId}}"]
        }
      },
      "response": []
    }
  ]
}
